# Heat Vulnerability Index (HVI) Johannesburg - Data Sources

This folder contains the primary data sources used in the Heat Vulnerability Index analysis for Johannesburg and scripts to reproduce the analysis.

## Files

### Data Files

#### 1. data.csv
Tabular data containing various indicators used for the Heat Vulnerability Index analysis, including:

##### Socioeconomic Variables:
- Crowded dwellings (`Crowded.dw`): Percentage of households living in crowded conditions
- No piped water (`No.piped.w`): Percentage of households without access to piped water
- Using public healthcare facilities (`Using.publ`): Percentage of population using public healthcare
- No medical insurance (`No.medical`): Percentage of population without medical insurance
- Household hunger risk (`Household`): Percentage of households at risk of hunger
- Benefiting from school feeding scheme (`Benefiting`): Percentage of children benefiting from school feeding schemes
- 60+ population proportion (`X60_plus_pr`): Percentage of population aged 60 and above

##### Health Variables:
- Poor health status (`Poor.healt`): Percentage of population reporting poor health
- Failed to find healthcare when needed (`Failed.to`): Percentage of population who failed to find healthcare when needed
- Health concern (`concern_he`): Level of health concern in the community
- Disease prevalence indicators:
  - Cancer proportion (`cancer_pro`): Prevalence of cancer
  - Diabetes proportion (`diabetes_p`): Prevalence of diabetes
  - Pneumonia proportion (`pneumonia_`): Prevalence of pneumonia
  - Heart disease proportion (`heart_dise`): Prevalence of heart disease
  - Hypertension proportion (`hypertensi`): Prevalence of hypertension
  - HIV proportion (`hiv_prop`): Prevalence of HIV
  - TB proportion (`tb_prop`): Prevalence of tuberculosis
  - COVID proportion (`covid_prop`): Prevalence of COVID-19

##### Environmental Variables:
- UTFVI (`UTFVI`): Urban Thermal Field Variance Index
- LST (`LST`): Land Surface Temperature
- NDVI (`NDVI`): Normalized Difference Vegetation Index
- NDBI (`NDBI__mean`): Normalized Difference Built-up Index

#### 2. geometry.shp (and related files)
Spatial data containing the ward boundaries for Johannesburg. The shapefile is in WGS 1984 UTM Zone 35S projection and includes:
- geometry.shp: The main shapefile with geometry
- geometry.shx: Shape index file
- geometry.dbf: Attribute data
- geometry.prj: Projection information
- geometry.cpg: Character encoding information

### Analysis Scripts

#### reproduce.R
A comprehensive R script that reproduces the entire Heat Vulnerability Index analysis for Johannesburg. The script:

1. Loads all necessary libraries and data
2. Performs data preparation and cleaning
3. Calculates summary statistics
4. Creates correlation matrices and visualizations
5. Performs Principal Component Analysis (PCA)
6. Calculates the Heat Vulnerability Index (HVI)
7. Identifies the most vulnerable wards
8. Performs spatial autocorrelation analysis using Local Moran's I
9. Conducts Geographically Weighted Principal Component Analysis (GWPCA)
10. Creates maps and visualizations of the results
11. Saves all outputs to the `outputs` directory

To run the script, use:
```r
# From R console
source("reproduce.R")

# From command line
Rscript reproduce.R
```

## Outputs Directory

The `outputs` directory contains all the visualizations and results generated by the `reproduce.R` script:

### Correlation Analysis
- `correlation_matrix.pdf` and `correlation_matrix.png`: Correlation matrix of all variables used in the analysis, color-coded by variable group (Environmental, Health, Socioeconomic)

### Principal Component Analysis
- `pca_loadings.pdf` and `pca_loadings.png`: Loadings plot for all principal components, showing the contribution of each variable
- `pc1_loadings.pdf` and `pc1_loadings.png`: Detailed loadings plot for the first principal component (PC1), which forms the basis of the Heat Vulnerability Index

### Heat Vulnerability Index Maps
- `hvi_map.pdf` and `hvi_map.png`: Map of the Heat Vulnerability Index across all wards in Johannesburg
- `top_10_vulnerable_wards.pdf` and `top_10_vulnerable_wards.png`: Map highlighting the top 10 most vulnerable wards based on the HVI

### Spatial Analysis
- `local_morans_i.pdf` and `local_morans_i.png`: Map of Local Moran's I statistics, showing spatial clusters of high and low vulnerability

### Geographically Weighted Principal Component Analysis
- `gwpca_hvi.pdf` and `gwpca_hvi.png`: Map of the Heat Vulnerability Index calculated using GWPCA
- `top_10_gwpca.pdf` and `top_10_gwpca.png`: Map highlighting the top 10 most vulnerable wards based on GWPCA

## Data Processing Workflow

The analysis follows this workflow:

1. **Data Preparation**:
   - Loading spatial data from shapefiles
   - Selecting relevant variables
   - Converting variables to numeric format
   - Removing missing values

2. **Descriptive Statistics**:
   - Computing summary statistics (mean, standard deviation, median, min, max)
   - Organizing variables into groups (Environmental, Health, Socioeconomic)

3. **Correlation Analysis**:
   - Computing correlation matrix
   - Visualizing correlations between variables

4. **Principal Component Analysis**:
   - Performing PCA on standardized variables
   - Extracting principal components and their loadings
   - Visualizing variable contributions to principal components

5. **Heat Vulnerability Index Calculation**:
   - Using the first principal component (PC1) as the Heat Vulnerability Index
   - Standardizing the index to a 0-1 scale
   - Mapping the index across Johannesburg wards
   - Identifying the most vulnerable wards

6. **Spatial Autocorrelation Analysis**:
   - Creating spatial weights matrix
   - Computing Global Moran's I to assess overall spatial autocorrelation
   - Computing Local Moran's I to identify spatial clusters
   - Mapping spatial clusters of vulnerability

7. **Geographically Weighted PCA**:
   - Estimating optimal bandwidth
   - Performing GWPCA with optimal bandwidth
   - Extracting GWPCA scores
   - Calculating localized Heat Vulnerability Index
   - Mapping GWPCA-based vulnerability
   - Identifying top vulnerable wards based on GWPCA

8. **Loadings Analysis**:
   - Analyzing variable contributions to PC1
   - Identifying key drivers of vulnerability
   - Visualizing PC1 loadings

## Map Visualization Details

The map visualizations incorporate the following features:

1. **Main Map Positioning**: 
   - The main map is positioned with bounds of (-25, 50) for longitude
   - Increased right margin creates space for the Europe inset map
   - The inset map is positioned at x-coordinate 0.82
   - All label positions are adjusted to match the new inset position

2. **Color Schemes**:
   - Heat Vulnerability Index: Viridis color palette (blue to yellow)
   - Local Moran's I: Custom color scheme for cluster types
   - GWPCA HVI: Viridis color palette

## Requirements

To run the analysis, you need R with the following packages:
- sf
- dplyr
- ggplot2
- corrplot
- psych
- GWmodel
- spdep
- factoextra
- RColorBrewer
- viridis
- tidyr
- scales

## Citation

When using this data or analysis, please cite:
[Citation information to be added]
